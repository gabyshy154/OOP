@using MeetAgain.Components.UI
@using MeetAgain.Services
@inherits LayoutComponentBase
@inject NotificationService NotificationService

<div class="app-container">
    <Header NotificationCount="@notificationCount" />
    
    @if (!string.IsNullOrEmpty(notificationMessage))
    {
        <div style="position: fixed; top: 80px; right: 20px; z-index: 1000; animation: slideIn 0.3s ease;">
            <div class="card" style="background: var(--success-color); color: white; padding: 1rem; box-shadow: var(--shadow-lg);">
                ✓ @notificationMessage
            </div>
        </div>
    }
    
    <main>
        @Body
    </main>
</div>

@code {
    private int notificationCount = 0;
    private string notificationMessage = string.Empty;

    protected override void OnInitialized()
    {
        NotificationService.OnNotification += HandleNotification;
    }

    private async void HandleNotification(string message)
    {
        notificationMessage = message;
        notificationCount++;
        StateHasChanged();
        
        await Task.Delay(3000);
        notificationMessage = string.Empty;
        StateHasChanged();
    }

    public void Dispose()
    {
        NotificationService.OnNotification -= HandleNotification;
    }
}